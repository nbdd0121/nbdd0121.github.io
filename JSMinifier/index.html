<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="../libs/orion/built-editor.css"/>
<script src="NorlitJSCompiler.js"></script>
<script src="../jquery/jquery.js"></script>
<script src="../libs/orion/built-editor.js"></script>
<script src="../libs/orion/custom-editor.js"></script>
<script src="../jquery/jquery-orion.js"></script>
<script>
	$(function(){
		$("#text").orion();
		editor=$("#text")[0].orion;
	});
	var editor;
</script>
<script>
	function validate(){
		editor.removeAllAnnotationMarks();

		var context = new NorlitJSCompiler.Context(true);
		try{
			var ast = NorlitJSCompiler.Parser($("#text").orion('text'), context);
		}catch(e){
			if(e instanceof SyntaxError){
				context.throwError(e);
			}else{
				$('.x-statusbar').text('Please report to the author: '+e);
				console.log(e.stack);
				throw e;
			}
		}
		if(!context.hasError()){
			$('.x-statusbar').text("No syntactical errors are found");
		}else{
			context.errors.forEach(function(msg){
				console.log(msg.detail);
				editor.addAnnotationMark('error', msg.toString(), msg.detail.startOffset, msg.detail.endOffset);
			});
			$('.x-statusbar').text(context.errors.length==1?'1 error is found':context.errors.length+' errors are found');
		}
	}
	function minify(){
		editor.removeAllAnnotationMarks();

		var context = new NorlitJSCompiler.Context(true);
		try{
			var ast = NorlitJSCompiler.Parser($("#text").orion('text'), context);
		}catch(e){
			if(e instanceof SyntaxError){
				context.throwError(e);
			}else{
				$('.x-statusbar').text('Please report to the author: '+e);
				console.log(e.stack);
				throw e;
			}
		}
		if(!context.hasError()){
			ast = NorlitJSCompiler.ASTPass.apply(ast);
			var str = NorlitJSCompiler.minify(ast).str;
			$('#text').orion('text', str);
			$('.x-statusbar').text("Minified without errors");
		}else{
			context.errors.forEach(function(msg){
				editor.addAnnotationMark('error', msg.toString(), msg.detail.startOffset, msg.detail.endOffset);
			});
			$('.x-statusbar').text(
				(context.errors.length==1?'1 error is':context.errors.length+' errors are')+
				' found, minification failed'
			);
		}
	}
</script>
<style>
	*{
		box-sizing:border-box;
	}
	html, body{
		height: 100%;
		margin: 0;
		padding: 0;
		overflow-y: hidden;
	}
	.x-titlebar{
		background: #2b579a;
		width:100%;
		height:50px;
		color:white;
		padding-left:20px;
		cursor:default;
		-webkit-user-select: none;
	}
	.x-titlebar .title{
		font-size: 24px;
		line-height: 50px;
	}
	.x-menubar{
		background: white;
		width:100%;
		height:30px;
		border-bottom: lightgrey solid 1px;
		-webkit-user-select: none;
		color:#444444;
		cursor:default;
	}
	.x-menubar .tabbutton{
		display: inline-block;
		height: 30px;
		line-height: 30px;
		font-size: 12px;
		padding-left: 8px;
		padding-right: 8px;
		text-transform: uppercase;
	}
	.x-menubar .tabbutton:first-child{
		padding-left: 20px;
		padding-right: 20px;
	}
	.x-menubar .tabbutton:hover{
		background: #d5e1f2;
		color:rgb(43, 87, 154);
	}
	.x-main{
		width:100%;
		height:calc(100% - 102px);
	}
	.x-statusbar {
		position: absolute;
		top:auto;
		bottom:0px;
		height:22px;
		width: 100%;
		background: white;
		font-size: 12px;
		color:rgb(68, 68, 68);
		line-height: 22px;
		border-top:lightgrey solid 1px;
		padding-left:10px;
	}

	#text{
		margin: 0px;
		padding: 0px;
		width: 100%;
		height:100%;
		font-size:14px;
	}

	::selection{
		background: rgba(200, 200, 200,0.99);
	}

	::-moz-selection{
		background: rgba(200, 200, 200,0.99);
	}
</style>
</head>
<body>
<div class="x-titlebar">
	<span class="title">Norlit JS Compiler Tools<span style="font-size:15px;"> Beta</span></span>
</div>
<div class="x-menubar">
	<span class="tabbutton" onclick="validate()">Validate</span>
	<span class="tabbutton" onclick="minify()">Minify</span>
</div>
<div class="x-main">
<pre id="text" class="editor">
</pre>
</div>
<div class="x-statusbar">
	Ready
</div>
</body>
</html>
